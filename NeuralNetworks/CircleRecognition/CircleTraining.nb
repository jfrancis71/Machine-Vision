(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     49585,       1167]
NotebookOptionsPosition[     48596,       1132]
NotebookOutlinePosition[     48942,       1147]
CellTagsIndexPosition[     48899,       1144]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"<<", 
  "\"\<C:/users/julian/documents/github/Machine-Vision/MVTools.m\>\""}]], \
"Code"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
    "returns", " ", "the", " ", "delta", " ", "kernel", " ", "resulting", " ",
      "from", " ", "input", " ", "mapping", " ", "onto", " ", "output", 
     "\[IndentingNewLine]", "  ", 
     RowBox[{"input", ":", " ", 
      RowBox[{"n", "*", "s", "*", "s", "\[IndentingNewLine]", 
       RowBox[{"output", ":", " ", 
        RowBox[{
        "n", "*", "s", "*", "s", " ", "where", " ", "s", " ", "is", " ", 
         "image", " ", "size"}]}]}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"i", ".", "e", ".", " ", "16"}], "*", "16", " ", "or", " ", "8", 
     "*", "8", " ", "or", " ", "4", "*", "4"}]}], "\[IndentingNewLine]", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"KernelDeltas", "[", 
    RowBox[{"inputs_", ",", "outputs_"}], "]"}], ":=", 
   RowBox[{"Transpose", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Total", "[", 
           RowBox[{"Flatten", "[", "#", "]"}], "]"}], "&"}], ",", 
         RowBox[{
          RowBox[{"Drop", "[", 
           RowBox[{"outputs", ",", "0", ",", 
            RowBox[{"-", "j"}], ",", 
            RowBox[{"-", "i"}]}], "]"}], "*", 
          RowBox[{"Drop", "[", 
           RowBox[{"inputs", ",", "0", ",", "j", ",", "i"}], "]"}]}]}], "]"}],
        ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", 
         RowBox[{"-", "2"}], ",", 
         RowBox[{"+", "2"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"-", "2"}], ",", 
         RowBox[{"+", "2"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "3", ",", "1"}], "}"}]}], "]"}]}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GradE1", "[", 
   RowBox[{"w_", ",", "labels_", ",", "ims_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"images", "=", 
     RowBox[{"ToPackedArray", "[", "ims", "]"}]}], ";", "\[IndentingNewLine]",
     "\[IndentingNewLine]", 
    RowBox[{"Timer", "[", 
     RowBox[{"\"\<ForProp=\>\"", ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ForwardPropogation", "[", 
        RowBox[{"images", ",", "w"}], "]"}], ";"}]}], "]"}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Timer", "[", 
     RowBox[{"\"\<DeltaO=\>\"", ",", 
      RowBox[{
       RowBox[{"DeltaO", "=", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"SoftMax", "[", 
             RowBox[{"OutputLayer", "[", 
              RowBox[{"[", "n", "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", "k", "]"}], "]"}], "-", 
           RowBox[{"Boole", "[", 
            RowBox[{
             RowBox[{"k", "-", "1"}], "\[Equal]", 
             RowBox[{"labels", "[", 
              RowBox[{"[", "n", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "1", ",", 
            RowBox[{"Length", "[", "labels", "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ";"}]}], 
     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Timer", "[", 
     RowBox[{"\"\<gw4=\>\"", ",", 
      RowBox[{
       RowBox[{"gw4", "=", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"DeltaO", "[", 
            RowBox[{"[", 
             RowBox[{"n", ",", "j"}], "]"}], "]"}], " ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"i", "\[Equal]", "0"}], ",", "1", ",", 
             RowBox[{"H3", "[", 
              RowBox[{"[", 
               RowBox[{"n", ",", "i"}], "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "1", ",", 
            RowBox[{"Length", "[", "labels", "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "30"}], "}"}]}], "]"}]}], ";"}]}], 
     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Timer", "[", 
     RowBox[{"\"\<DeltaH3=\>\"", ",", 
      RowBox[{
       RowBox[{"DeltaH3", "=", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           FractionBox["1", 
            RowBox[{"1", "+", 
             SuperscriptBox[
              RowBox[{"H3A", "[", 
               RowBox[{"[", 
                RowBox[{"n", ",", "j"}], "]"}], "]"}], "2"]}]], " ", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"DeltaO", "[", 
               RowBox[{"[", 
                RowBox[{"n", ",", "k"}], "]"}], "]"}], " ", 
              RowBox[{"w", "[", 
               RowBox[{"[", 
                RowBox[{"4", ",", "k", ",", 
                 RowBox[{"j", "+", "1"}]}], "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "1", ",", 
            RowBox[{"Length", "[", "labels", "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "30"}], "}"}]}], "]"}]}], ";"}]}], 
     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Timer", "[", 
     RowBox[{"\"\<gw3=\>\"", ",", 
      RowBox[{
       RowBox[{"gw3", " ", "=", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"DeltaH3", "[", 
            RowBox[{"[", 
             RowBox[{"n", ",", "j"}], "]"}], "]"}], " ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"i", "\[Equal]", "0"}], ",", "1", ",", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"H2", "[", 
                RowBox[{"[", "n", "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"n", ",", "1", ",", 
            RowBox[{"Length", "[", "labels", "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "30"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "192"}], "}"}]}], "]"}]}], ";"}]}], 
     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Timer", "[", 
       RowBox[{"\"\<DeltaH2=\>\"", ",", 
        RowBox[{
         RowBox[{"DeltaH2", "=", "\[IndentingNewLine]", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             FractionBox["1", 
              RowBox[{"1", "+", 
               SuperscriptBox[
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{"H2A", "[", 
                   RowBox[{"[", "n", "]"}], "]"}], "]"}], "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "2"]}]], " ", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"DeltaH3", "[", 
                 RowBox[{"[", 
                  RowBox[{"n", ",", "k"}], "]"}], "]"}], " ", 
                RowBox[{"w", "[", 
                 RowBox[{"[", 
                  RowBox[{"3", ",", "k", ",", 
                   RowBox[{"j", "+", "1"}]}], "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", "30"}], "}"}]}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "1", ",", 
              RowBox[{"Length", "[", "images", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", "192"}], "}"}]}], "]"}]}], ";"}]}], 
       "]"}], ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"Timer", "[", 
     RowBox[{"\"\<DeltaH2=\>\"", ",", 
      RowBox[{
       RowBox[{"DeltaH2", "=", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           FractionBox["1", 
            RowBox[{"1", "+", 
             SuperscriptBox[
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"H2A", "[", 
                 RowBox[{"[", "n", "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "j", "]"}], "]"}], "2"]}]], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "1", ",", 
             RowBox[{"Length", "[", "labels", "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "192"}], "}"}]}], "]"}], " ", "*", 
         "\[IndentingNewLine]", 
         RowBox[{"DeltaH3", ".", 
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"w", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", "0", ",", "1"}], 
           "]"}]}]}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"(*", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ptmp", "=", 
       RowBox[{"ToPackedArray", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{"#", ",", "4"}], "]"}], "&"}], ",", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"DeltaH2", "[", 
               RowBox[{"[", "n", "]"}], "]"}], ",", "16"}], "]"}]}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "1", ",", 
            RowBox[{"Length", "[", "labels", "]"}]}], "}"}]}], "]"}], "]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"pH1tmp", "=", 
       RowBox[{"ToPackedArray", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"ArrayPad", "[", 
           RowBox[{
            RowBox[{"H1", "[", 
             RowBox[{"[", 
              RowBox[{"n", ",", "f2"}], "]"}], "]"}], ",", "2"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "1", ",", 
            RowBox[{"Length", "[", "labels", "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"f2", ",", "1", ",", "12"}], "}"}]}], "]"}], "]"}]}], 
      ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Timer", "[", 
       RowBox[{"\"\<gw2=\>\"", ",", 
        RowBox[{
         RowBox[{"gw2", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Prepend", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"ptmp", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", ",", "f1"}], "]"}], "]"}], "]"}], ".", " ", 
                  RowBox[{"Extract", "[", 
                   RowBox[{
                    RowBox[{"pH1tmp", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], ",", 
                    RowBox[{"coords", "[", 
                    RowBox[{"[", 
                    RowBox[{"f2", ",", "cr", ",", "cc"}], "]"}], "]"}]}], 
                   "]"}]}], ",", 
                 RowBox[{"{", 
                  RowBox[{"cr", ",", "1", ",", "5"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"cc", ",", "1", ",", "5"}], "}"}]}], "]"}], "]"}], 
              ",", 
              RowBox[{"Total", "[", 
               RowBox[{
                RowBox[{"Partition", "[", 
                 RowBox[{
                  RowBox[{"DeltaH2", "[", 
                   RowBox[{"[", "n", "]"}], "]"}], ",", "16"}], "]"}], "[", 
                RowBox[{"[", "f1", "]"}], "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "1", ",", 
              RowBox[{"Length", "[", "labels", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"f1", ",", "1", ",", "12"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"f2", ",", "1", ",", "12"}], "}"}]}], "]"}]}], ";"}]}], 
       "]"}], ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"Timer", "[", 
     RowBox[{"\"\<partitioning DeltaH2\>\"", ",", 
      RowBox[{
       RowBox[{"partitionedDeltaH2", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Partition", "[", 
               RowBox[{"#", ",", "4"}], "]"}], "&"}], ",", 
             RowBox[{"Partition", "[", 
              RowBox[{"#", ",", "16"}], "]"}]}], "]"}], "&"}], ",", 
          "DeltaH2"}], "]"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"Timer", "[", 
     RowBox[{"\"\<upSamplingDeltaH2\>\"", ",", 
      RowBox[{
       RowBox[{"upSampleDeltaH2", "=", "\[IndentingNewLine]", 
        RowBox[{"ToPackedArray", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"EvenQ", "[", "r", "]"}], "&&", 
              RowBox[{"EvenQ", "[", "c", "]"}]}], ",", 
             RowBox[{"partitionedDeltaH2", "[", 
              RowBox[{"[", 
               RowBox[{"n", ",", "f1", ",", 
                RowBox[{"r", "/", "2"}], ",", 
                RowBox[{"c", "/", "2"}]}], "]"}], "]"}], ",", "0.0"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "1", ",", 
             RowBox[{"Length", "[", "labels", "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"f1", ",", "1", ",", "12"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"r", ",", "1", ",", "8"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"c", ",", "1", ",", "8"}], "}"}]}], "]"}], "]"}]}], 
       ";"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Timer", "[", 
     RowBox[{"\"\<gw2=\>\"", ",", 
      RowBox[{
       RowBox[{"gw2", "=", "\[IndentingNewLine]", 
        RowBox[{"Transpose", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"MapThread", "[", "\[IndentingNewLine]", 
             RowBox[{"Prepend", ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Map", "[", 
                 RowBox[{"Flatten", ",", 
                  RowBox[{"KernelDeltas", "[", 
                   RowBox[{
                    RowBox[{"H1", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "f2"}], "]"}], "]"}], ",", 
                    RowBox[{"upSampleDeltaH2", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "f1"}], "]"}], "]"}]}], "]"}]}], 
                 "]"}], ",", "\[IndentingNewLine]", 
                RowBox[{"Map", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{
                    RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "16"}], "]"}], "[", 
                    RowBox[{"[", "f1", "]"}], "]"}], "]"}], "&"}], ",", 
                  "DeltaH2"}], "]"}]}], "}"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"f1", ",", "1", ",", "12"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"f2", ",", "1", ",", "12"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "3", ",", "1"}], "}"}]}], "]"}]}], ";"}]}], 
     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"ptmp", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ArrayPad", "[", 
             RowBox[{
              RowBox[{"Partition", "[", 
               RowBox[{"#", ",", "4"}], "]"}], ",", "2"}], "]"}], "&"}], ",", 
           RowBox[{"Partition", "[", 
            RowBox[{"DeltaH2", ",", "16"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "1", ",", 
           RowBox[{"Length", "[", "labels", "]"}]}], "}"}]}], "]"}]}], ";"}], 
     "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"upSampleDeltaH2", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"EvenQ", "[", "r", "]"}], "&&", 
            RowBox[{"EvenQ", "[", "c", "]"}]}], ",", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Partition", "[", 
                RowBox[{"#", ",", "4"}], "]"}], "&"}], ",", 
              RowBox[{"Partition", "[", 
               RowBox[{
                RowBox[{"DeltaH2", "[", 
                 RowBox[{"[", "n", "]"}], "]"}], ",", "16"}], "]"}]}], "]"}], 
            "[", 
            RowBox[{"[", 
             RowBox[{"f1", ",", 
              RowBox[{"r", "/", "2"}], ",", 
              RowBox[{"c", "/", "2"}]}], "]"}], "]"}], ",", "0.0"}], "]"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "1", ",", 
           RowBox[{"Length", "[", "labels", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"f1", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"r", ",", "1", ",", "8"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"c", ",", "1", ",", "8"}], "}"}]}], "]"}]}], ";"}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"DeltaH1", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          FractionBox["1", 
           RowBox[{"1", "+", 
            SuperscriptBox[
             RowBox[{"H1A", "[", 
              RowBox[{"[", 
               RowBox[{"f1", ",", "r", ",", "c"}], "]"}], "]"}], "2"]}]], "*",
           "\[IndentingNewLine]", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"EvenQ", "[", 
                 RowBox[{"r", "-", "j"}], "]"}], "&&", 
                RowBox[{"EvenQ", "[", 
                 RowBox[{"c", "-", "i"}], "]"}]}], ",", " ", 
               "\[IndentingNewLine]", 
               RowBox[{"ptmp", "[", 
                RowBox[{"[", 
                 RowBox[{"f2", ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"r", "-", "j"}], ")"}], "/", "2"}], "+", "2"}], 
                  ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"c", "-", "i"}], ")"}], "/", "2"}], "+", "2"}]}], 
                 "]"}], "]"}], ",", "0"}], "]"}], "*", 
             RowBox[{"w", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "f2", ",", "f1", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"j", "+", "2"}], ")"}], "*", "5"}], "+", "i", "+", 
                 "3", "+", "1"}]}], "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"f2", ",", "1", ",", "12"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"-", "2"}], ",", 
              RowBox[{"+", "2"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"-", "2"}], ",", 
              RowBox[{"+", "2"}]}], "}"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"f1", ",", "1", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"r", ",", "1", ",", "8"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"c", ",", "1", ",", "8"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"Timer", "[", 
     RowBox[{"\"\<kernelPts=\>\"", ",", 
      RowBox[{
       RowBox[{"kernelPts", "=", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Partition", "[", 
           RowBox[{
            RowBox[{"Rest", "[", 
             RowBox[{"w", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "f2", ",", "f1"}], "]"}], "]"}], "]"}], ",", 
            "5"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"f1", ",", "1", ",", "12"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"f2", ",", "1", ",", "12"}], "}"}]}], "]"}]}], ";"}]}], 
     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Timer", "[", 
     RowBox[{"\"\<DeltaH1=\>\"", ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"precomp", "=", 
        RowBox[{"Transpose", "[", "\[IndentingNewLine]", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Sum", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"ListConvolve", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"kernelPts", "[", 
                 RowBox[{"[", 
                  RowBox[{"f1", ",", "f2"}], "]"}], "]"}], "}"}], ",", 
               RowBox[{"upSampleDeltaH2", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "f2"}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3", ",", "3"}], "}"}], ",", "0"}], "]"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"f2", ",", "1", ",", "12"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"f1", ",", "1", ",", "12"}], "}"}]}], "]"}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"DeltaH1", "=", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             FractionBox["1", 
              RowBox[{"1", "+", 
               SuperscriptBox[
                RowBox[{"H1A", "[", 
                 RowBox[{"[", 
                  RowBox[{"n", ",", "f1", ",", "r", ",", "c"}], "]"}], "]"}], 
                "2"]}]], ",", 
             RowBox[{"{", 
              RowBox[{"r", ",", "1", ",", "8"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"c", ",", "1", ",", "8"}], "}"}]}], "]"}], "*", 
           "\[IndentingNewLine]", 
           RowBox[{"precomp", "[", 
            RowBox[{"[", 
             RowBox[{"n", ",", "f1"}], "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "1", ",", 
            RowBox[{"Length", "[", "labels", "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"f1", ",", "1", ",", "12"}], "}"}]}], "]"}]}], ";"}]}], 
     "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"(*", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Timer", "[", 
       RowBox[{"\"\<upSampleDeltaH1=\>\"", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"upSampleDeltaH1", "=", 
          RowBox[{"ToPackedArray", "[", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"EvenQ", "[", "r", "]"}], "&&", 
                RowBox[{"EvenQ", "[", "c", "]"}]}], ",", 
               RowBox[{"DeltaH1", "[", 
                RowBox[{"[", 
                 RowBox[{"n", ",", "f1", ",", 
                  RowBox[{"r", "/", "2"}], ",", 
                  RowBox[{"c", "/", "2"}]}], "]"}], "]"}], ",", "0.0"}], 
              "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"n", ",", "1", ",", 
               RowBox[{"Length", "[", "labels", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"f1", ",", "1", ",", "12"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"r", ",", "1", ",", "16"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"c", ",", "1", ",", "16"}], "}"}]}], "]"}], "]"}]}], 
         ";"}]}], "]"}], ";"}], "\[IndentingNewLine]", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Timer", "[", 
     RowBox[{"\"\<upSampleDeltaH1=\>\"", ",", 
      RowBox[{
       RowBox[{"upSampleDeltaH1", "=", "\[IndentingNewLine]", 
        RowBox[{"ToPackedArray", "[", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Riffle", "[", 
            RowBox[{
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Riffle", "[", 
                 RowBox[{"#", ",", "0.0", ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "15", ",", "2"}], "}"}]}], "]"}], "&"}], 
               ",", 
               RowBox[{"DeltaH1", "[", 
                RowBox[{"[", 
                 RowBox[{"n", ",", "f1"}], "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{"0.0", ",", "16"}], "]"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "15", ",", "2"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "1", ",", 
             RowBox[{"Length", "[", "labels", "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"f1", ",", "1", ",", "12"}], "}"}]}], "]"}], "]"}]}], 
       ";"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Timer", "[", 
       RowBox[{"\"\<gw1=\>\"", ",", 
        RowBox[{"gw1", "=", "\[IndentingNewLine]", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Prepend", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{"Drop", "[", 
                   RowBox[{
                    RowBox[{"upSampleDeltaH1", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", ",", "f1"}], "]"}], "]"}], ",", 
                    RowBox[{"-", "j"}], ",", 
                    RowBox[{"-", "i"}]}], "]"}], "]"}], ".", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"Drop", "[", 
                   RowBox[{
                    RowBox[{"images", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], ",", "j", ",", "i"}], 
                   "]"}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", 
                  RowBox[{"-", "2"}], ",", 
                  RowBox[{"+", "2"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", 
                  RowBox[{"-", "2"}], ",", 
                  RowBox[{"+", "2"}]}], "}"}]}], "]"}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Total", "[", 
              RowBox[{
               RowBox[{"DeltaH1", "[", 
                RowBox[{"[", 
                 RowBox[{"n", ",", "f1"}], "]"}], "]"}], ",", "2"}], "]"}]}], 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"n", ",", "1", ",", 
             RowBox[{"Length", "[", "labels", "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"f1", ",", "1", ",", "12"}], "}"}]}], "]"}]}]}], "]"}], 
      ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Timer", "[", 
     RowBox[{"\"\<gw1=\>\"", ",", 
      RowBox[{
       RowBox[{"gw1", "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"MapThread", "[", "\[IndentingNewLine]", 
             RowBox[{"Prepend", ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Map", "[", 
                 RowBox[{"Flatten", ",", 
                  RowBox[{"KernelDeltas", "[", 
                   RowBox[{"images", ",", 
                    RowBox[{"upSampleDeltaH1", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "f1"}], "]"}], "]"}]}], "]"}]}], 
                 "]"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Map", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Total", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "&"}], ",", "DeltaH1", 
                   ",", 
                   RowBox[{"{", "2", "}"}]}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "f1"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"f1", ",", "1", ",", "12"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";"}]}], 
     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Map", "[", 
     RowBox[{"Total", ",", 
      RowBox[{"{", 
       RowBox[{"gw1", ",", "gw2", ",", "gw3", ",", "gw4"}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", ")"}]}]], "Input",
 CellChangeTimes->{{3.59456622312085*^9, 3.594566504352936*^9}, {
   3.594566991927823*^9, 3.594566992623863*^9}, {3.5945671087505054`*^9, 
   3.594567113497777*^9}, {3.5945672003867464`*^9, 3.5945673511883717`*^9}, {
   3.594567400584197*^9, 3.5945674038283825`*^9}, {3.5945676975511827`*^9, 
   3.5945677189654074`*^9}, {3.5945680080009394`*^9, 3.594568062193039*^9}, {
   3.5945680983971095`*^9, 3.5945681406705275`*^9}, {3.594568245541526*^9, 
   3.594568308432123*^9}, {3.594568542955537*^9, 3.5945685975686607`*^9}, {
   3.5945687374836636`*^9, 3.594568771765624*^9}, {3.594573733827224*^9, 
   3.5945737354343157`*^9}, {3.5946365293059883`*^9, 
   3.5946365824660287`*^9}, {3.5946367429122057`*^9, 3.59463674910456*^9}, {
   3.5946375937748723`*^9, 3.594637600530259*^9}, {3.5946379581497135`*^9, 
   3.594637993459733*^9}, {3.5946381247722435`*^9, 3.594638128447454*^9}, {
   3.594638180108409*^9, 3.5946381802954197`*^9}, {3.5946384015350733`*^9, 
   3.5946384109706135`*^9}, {3.5946384783734684`*^9, 3.594638503662915*^9}, {
   3.594638752318137*^9, 3.594638768132042*^9}, {3.5946389002535987`*^9, 
   3.594638953370637*^9}, {3.59464165427512*^9, 3.594641755633917*^9}, {
   3.5946418002444687`*^9, 3.5946418188795347`*^9}, 3.594642122324891*^9, {
   3.594711642834236*^9, 3.5947116430452485`*^9}, {3.5947118197013526`*^9, 
   3.594711819902364*^9}, {3.5947129305328884`*^9, 3.594712969952143*^9}, {
   3.5947131687165117`*^9, 3.5947132124080105`*^9}, {3.594716203575096*^9, 
   3.5947165518770175`*^9}, {3.5947199244749193`*^9, 3.594719965908289*^9}, {
   3.5947200929635563`*^9, 3.5947201967984953`*^9}, {3.594720638528761*^9, 
   3.5947206485463333`*^9}, {3.5947208995166883`*^9, 3.594720916237645*^9}, {
   3.5947209843295393`*^9, 3.594720989777851*^9}, {3.5947210250048656`*^9, 
   3.5947211427496004`*^9}, {3.5947211755694776`*^9, 3.594721189668284*^9}, {
   3.5947219094644537`*^9, 3.594721909602462*^9}, {3.594721944483457*^9, 
   3.5947220079210854`*^9}, {3.5947220596710453`*^9, 
   3.5947221734615536`*^9}, {3.5947226633605747`*^9, 3.594722663482581*^9}, {
   3.5947229377662697`*^9, 3.594723034009774*^9}, {3.594723143131016*^9, 
   3.594723176448921*^9}, {3.5947237052251654`*^9, 3.5947237092073936`*^9}, {
   3.5947237983894944`*^9, 3.5947238109952154`*^9}, {3.594723856231803*^9, 
   3.5947239321901474`*^9}, 3.5947239937746696`*^9, {3.5947240462596717`*^9, 
   3.594724104941028*^9}, {3.594724150726647*^9, 3.5947241538958282`*^9}, {
   3.594724254235567*^9, 3.5947242678393455`*^9}, {3.594724370427213*^9, 
   3.5947243813958406`*^9}, {3.5947244706879473`*^9, 
   3.5947244769783077`*^9}, {3.59472464066567*^9, 3.594724642482774*^9}, {
   3.5947246938257103`*^9, 3.5947247997407684`*^9}, {3.5947248425422163`*^9, 
   3.5947248463764358`*^9}, {3.5947248995704784`*^9, 3.594724907707944*^9}, {
   3.594724956882756*^9, 3.5947249601219416`*^9}, {3.5947250210504265`*^9, 
   3.5947250211234307`*^9}, {3.594725261801197*^9, 3.5947252925349545`*^9}, {
   3.594726863755823*^9, 3.594726867823056*^9}, {3.594730964091349*^9, 
   3.5947312031520224`*^9}, {3.594731284355667*^9, 3.594731306838953*^9}, {
   3.5947313456061707`*^9, 3.5947315031711826`*^9}, {3.5947315722501335`*^9, 
   3.5947315861799307`*^9}, {3.5947316245241237`*^9, 
   3.5947316289643774`*^9}, {3.59473169701227*^9, 3.5947317175264435`*^9}, {
   3.5947317707124853`*^9, 3.5947317816941133`*^9}, {3.5947319668187017`*^9, 
   3.5947319704189076`*^9}, {3.5947322681949396`*^9, 
   3.5947322718151464`*^9}, {3.594733899519246*^9, 3.594733914308092*^9}, {
   3.594734031210778*^9, 3.5947340393552437`*^9}, {3.594734074677264*^9, 
   3.5947340752892995`*^9}, {3.5947342759587774`*^9, 
   3.5947342799010024`*^9}, {3.5947936022090445`*^9, 
   3.5947936469316025`*^9}, {3.5947936847857676`*^9, 3.594793688025953*^9}, {
   3.594793873930586*^9, 3.5947938755366783`*^9}, {3.594794328675596*^9, 
   3.594794332197798*^9}, {3.5947943975665364`*^9, 3.5947944001036816`*^9}, {
   3.5947949294199567`*^9, 3.594794976383643*^9}, {3.594795655986514*^9, 
   3.594795711746703*^9}, {3.5947957660278077`*^9, 3.5947958340516987`*^9}, {
   3.5947958683936625`*^9, 3.5947958800433292`*^9}, {3.5947959109540973`*^9, 
   3.5947959282520866`*^9}, {3.5947959690954227`*^9, 3.594795971054535*^9}, {
   3.594796023844554*^9, 3.5947960242555776`*^9}, {3.5947960593205833`*^9, 
   3.5947960602386355`*^9}, 3.594796118653977*^9, {3.594796411419722*^9, 
   3.5947964150299287`*^9}, {3.5947964834898443`*^9, 
   3.5947964935184183`*^9}, {3.594796629087172*^9, 3.5947966346764917`*^9}, {
   3.5947967822149305`*^9, 3.594796827596526*^9}, {3.5947981951337447`*^9, 
   3.594798242794471*^9}, {3.594798532207024*^9, 3.5947985345641594`*^9}, {
   3.5947990672096243`*^9, 3.5947990677996583`*^9}, {3.594799165433243*^9, 
   3.5947991679823885`*^9}, {3.594799229920931*^9, 3.5947992352432356`*^9}, {
   3.59479942851129*^9, 3.5947994292023296`*^9}, {3.594804020017909*^9, 
   3.594804025312212*^9}, {3.5948042355832386`*^9, 3.594804241047551*^9}, {
   3.5948063340932665`*^9, 3.5948064430544987`*^9}, {3.5948066255719385`*^9, 
   3.59480670061423*^9}, {3.5948094200237713`*^9, 3.5948094381898108`*^9}, {
   3.5948094868295927`*^9, 3.594809499840337*^9}, {3.5948095767927384`*^9, 
   3.594809602849229*^9}, {3.594809933906164*^9, 3.5948099386074333`*^9}, {
   3.594810037076065*^9, 3.594810049419771*^9}, 3.5948130795270834`*^9, {
   3.5948131791897836`*^9, 3.5948132697529635`*^9}, {3.5948133353337145`*^9, 
   3.5948133375998445`*^9}, {3.594813393004013*^9, 3.5948134247598295`*^9}, {
   3.5948139112036524`*^9, 3.5948139126427345`*^9}, {3.59481396902896*^9, 
   3.594813978893524*^9}, {3.5948149300489273`*^9, 3.5948149703542323`*^9}, {
   3.594816124474244*^9, 3.59481612929552*^9}, {3.5948162075839977`*^9, 
   3.594816220497737*^9}, {3.594965075813865*^9, 3.5949650982011456`*^9}, 
   3.594965134972249*^9, {3.594965170083257*^9, 3.5949652313917637`*^9}, {
   3.594972119303687*^9, 3.594972146502242*^9}, {3.594972241408671*^9, 
   3.594972245628912*^9}, 3.594972396174523*^9, {3.595060667074933*^9, 
   3.5950606914093246`*^9}, {3.595060944616807*^9, 3.5950609509641705`*^9}, {
   3.5950624723821907`*^9, 3.5950624953235025`*^9}, {3.5950655255128193`*^9, 
   3.595065526869897*^9}, {3.5950656274246483`*^9, 3.595065687287072*^9}, {
   3.5950657186608667`*^9, 3.5950657260302887`*^9}, {3.5950657606412683`*^9, 
   3.5950659828639784`*^9}, {3.5950660342909203`*^9, 3.595066091358184*^9}, {
   3.5950661789171925`*^9, 3.5950662031765795`*^9}, {3.595068971589924*^9, 
   3.5950691680601616`*^9}, {3.5950692145118184`*^9, 3.595069369465681*^9}, {
   3.595069467866309*^9, 3.5950694842342453`*^9}, {3.595069655198024*^9, 
   3.5950696576691656`*^9}, {3.5950698465329676`*^9, 3.595069847075999*^9}, {
   3.595069943847534*^9, 3.595069969522002*^9}, {3.59507005776505*^9, 
   3.595070088105785*^9}, {3.595070124873888*^9, 3.595070130122188*^9}, {
   3.5950701648021717`*^9, 3.5950702385313888`*^9}, {3.5950709997289267`*^9, 
   3.595071032370794*^9}, {3.595071093183272*^9, 3.595071161236164*^9}, 
   3.5950722184266324`*^9, {3.59507338698147*^9, 3.5950733888805785`*^9}, {
   3.595075484513442*^9, 3.5950754869105787`*^9}, {3.5950756197571774`*^9, 
   3.5950756593104396`*^9}, 3.595075738024942*^9, {3.595075972880375*^9, 
   3.595076096417441*^9}, 3.5950761272392035`*^9, {3.5950761787461495`*^9, 
   3.5950762271809196`*^9}, {3.5950794842232122`*^9, 3.595079617653844*^9}, {
   3.595142202845478*^9, 3.595142212059005*^9}, {3.5952310989590445`*^9, 
   3.595231114857954*^9}, 3.5952321466239676`*^9, {3.5952335235347223`*^9, 
   3.595233525095812*^9}, {3.5952390950443945`*^9, 3.595239176492053*^9}, 
   3.5952392859293127`*^9, {3.595240889315021*^9, 3.5952409423850565`*^9}, {
   3.59524230912523*^9, 3.5952423161686325`*^9}, {3.595242986748987*^9, 
   3.595242988249073*^9}, {3.5952438260119905`*^9, 3.595243832402356*^9}, {
   3.5952439043984737`*^9, 3.5952439046134863`*^9}, 3.595243972887391*^9, {
   3.595244101532749*^9, 3.5952441401349573`*^9}, {3.5952441719387765`*^9, 
   3.595244186811627*^9}, 3.5952443448066635`*^9, {3.5952450936944976`*^9, 
   3.5952451010379176`*^9}, {3.595245689795593*^9, 3.5952457961326747`*^9}, {
   3.595245827853489*^9, 3.5952458324317513`*^9}, 3.595248215893077*^9, {
   3.5952482478199034`*^9, 3.5952482538192463`*^9}, {3.5952483627644777`*^9, 
   3.595248376951289*^9}, {3.595314125581951*^9, 3.5953141799230595`*^9}, {
   3.595314245696821*^9, 3.5953142578505163`*^9}, {3.595314338741143*^9, 
   3.595314362199485*^9}, {3.5953144430591097`*^9, 3.5953144446261992`*^9}, {
   3.595314553788443*^9, 3.595314556286586*^9}, {3.5953146564333143`*^9, 
   3.5953146686270113`*^9}, {3.595314701389885*^9, 3.595314775994152*^9}, {
   3.5953148301262484`*^9, 3.5953150159048743`*^9}, {3.595315115115549*^9, 
   3.5953151624032536`*^9}, {3.5953156475980053`*^9, 3.595315691147496*^9}, {
   3.5953157684249163`*^9, 3.5953157874130025`*^9}, {3.5953158699687243`*^9, 
   3.5953158716288195`*^9}, {3.595315912793174*^9, 3.595315962367009*^9}, {
   3.5953160175441647`*^9, 3.5953160432466354`*^9}, {3.595317909474377*^9, 
   3.5953179489526353`*^9}, {3.595317981652506*^9, 3.5953179874088345`*^9}, {
   3.5953204996805286`*^9, 3.595320500717588*^9}, {3.640152590412073*^9, 
   3.6401526353989615`*^9}, {3.6401526698272347`*^9, 
   3.6401527823028636`*^9}, {3.64015283477717*^9, 3.640152868231444*^9}, {
   3.6401528989973106`*^9, 3.640152899449711*^9}, {3.6401610642439528`*^9, 
   3.640161066190064*^9}, {3.6401611103125877`*^9, 3.640161112067688*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"BatchGradientDescent", "[", "w_", "]"}], ":=", 
  RowBox[{"w", "-", 
   RowBox[{"(", 
    RowBox[{"0.00001", "*", 
     RowBox[{"(", 
      RowBox[{"wtmp", "=", "\[IndentingNewLine]", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{"GradE1", "[", 
          RowBox[{"w", ",", 
           RowBox[{"TrainingLabels", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{
               RowBox[{"s", "*", "1000"}], "+", "1"}], ";;", 
              RowBox[{
               RowBox[{"s", "*", "1000"}], "+", "1000"}]}], "]"}], "]"}], ",", 
           RowBox[{"TrainingImages", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{
               RowBox[{"s", "*", "1000"}], "+", "1"}], ";;", 
              RowBox[{
               RowBox[{"s", "*", "1000"}], "+", "1000"}]}], "]"}], "]"}]}], 
          "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"s", ",", "0", ",", "0"}], "}"}]}], "]"}]}], 
      "\[IndentingNewLine]", ")"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{
  3.6401530726108603`*^9, 3.640153119873154*^9, {3.6401537833947134`*^9, 
   3.640153783521514*^9}, {3.6401539920367193`*^9, 3.6401539941123285`*^9}, {
   3.6401541600901213`*^9, 3.6401541602541227`*^9}, {3.6401598506335382`*^9, 
   3.6401598507935476`*^9}, {3.6401601264423137`*^9, 
   3.6401601265843215`*^9}, {3.6401603499220963`*^9, 3.640160350060104*^9}, {
   3.6401606806420116`*^9, 3.640160680809022*^9}, {3.640162004826751*^9, 
   3.6401620858543854`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GradientDescent", "[", "w_", "]"}], ":=", 
  RowBox[{"StochasticGradientDescent", "[", "w", "]"}]}]], "Input",
 CellChangeTimes->{{3.5953925961863375`*^9, 3.5953925976604214`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"StochasticGradientDescent", "[", "w_", "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"wret", "=", "w"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Table", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"wret", "=", 
       RowBox[{"wret", "-", 
        RowBox[{"0.0001", "*", 
         RowBox[{"GradE1", "[", 
          RowBox[{"wret", ",", 
           RowBox[{"TrainingLabels", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{
               RowBox[{"s", "*", "100"}], "+", "1"}], ";;", 
              RowBox[{
               RowBox[{"s", "*", "100"}], "+", "100"}]}], "]"}], "]"}], ",", 
           RowBox[{"TrainingImages", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{
               RowBox[{"s", "*", "100"}], "+", "1"}], ";;", 
              RowBox[{
               RowBox[{"s", "*", "100"}], "+", "100"}]}], "]"}], "]"}]}], 
          "]"}]}]}]}], ",", 
      RowBox[{"{", 
       RowBox[{"s", ",", "0", ",", "9"}], "}"}]}], "]"}], ";", 
    "\[IndentingNewLine]", "wret"}], " ", ")"}]}]], "Input",
 CellChangeTimes->{{3.595392345068974*^9, 3.5953923546925244`*^9}, {
   3.5953925041530733`*^9, 3.595392586689794*^9}, 3.595397419153195*^9, {
   3.5954225083472147`*^9, 3.595422528476366*^9}, 3.5956624562119603`*^9, {
   3.6405861480078325`*^9, 3.640586177073102*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Length", "[", "TrainingImages", "]"}]], "Input",
 CellChangeTimes->{{3.640586024375792*^9, 3.640586027700598*^9}, {
  3.640586061403067*^9, 3.6405860620904684`*^9}}],

Cell[BoxData["1000"], "Output",
 CellChangeTimes->{{3.640586028184199*^9, 3.640586062309869*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Timer", "[", 
   RowBox[{"message_", ",", "expr_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"timers", "\[Equal]", "True"}], ",", 
    RowBox[{"Print", "[", 
     RowBox[{"message", ",", 
      RowBox[{"Timing", "[", 
       RowBox[{"expr", ";"}], "]"}]}], "]"}], ",", 
    RowBox[{"expr", ";"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.5950794083278713`*^9, 3.5950794722925296`*^9}, {
  3.5951418286060724`*^9, 3.595141842964894*^9}}],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"Timer", ",", "HoldAll"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"winitial", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Random", "[", "]"}], "-", "0.5"}], ",", 
       RowBox[{"{", 
        RowBox[{"f1", ",", "1", ",", "12"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "25"}], "}"}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Random", "[", "]"}], "-", "0.5"}], ",", 
       RowBox[{"{", 
        RowBox[{"f1", ",", "1", ",", "12"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"f2", ",", "1", ",", "12"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "25"}], "}"}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Random", "[", "]"}], "-", "0.5"}], ",", 
       RowBox[{"{", 
        RowBox[{"u1", ",", "1", ",", "30"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"in", ",", "0", ",", "192"}], "}"}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Random", "[", "]"}], "-", "0.5"}], ",", 
       RowBox[{"{", 
        RowBox[{"u1", ",", "1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"in", ",", "0", ",", "30"}], "}"}]}], "]"}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.594464276520293*^9, 3.594464283542695*^9}, {
   3.594464821739478*^9, 3.594464826700762*^9}, {3.594465029955387*^9, 
   3.5944650508535824`*^9}, {3.594465088955762*^9, 3.5944651052136917`*^9}, {
   3.5945457860803733`*^9, 3.594545799328131*^9}, {3.5945488741029983`*^9, 
   3.594548904519738*^9}, {3.5945489689584236`*^9, 3.594549002935367*^9}, {
   3.5945512131733303`*^9, 3.594551240814911*^9}, {3.594551561110231*^9, 
   3.594551567231581*^9}, {3.5945518006329308`*^9, 3.5945518047561665`*^9}, {
   3.5946341445595884`*^9, 3.59463415751433*^9}, {3.594635047586239*^9, 
   3.5946350578478255`*^9}, {3.5948149980138144`*^9, 3.594815000143936*^9}, 
   3.5948158389349127`*^9, {3.5948185090696354`*^9, 3.594818519826251*^9}, {
   3.6405865497676454`*^9, 3.640586550110846*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"myF", "[", "w_", "]"}], ":=", 
  RowBox[{"Function", "[", 
   RowBox[{"inputs", ",", 
    RowBox[{"Map", "[", 
     RowBox[{"SoftMax", ",", 
      RowBox[{"ForwardPropogation", "[", 
       RowBox[{"inputs", ",", "w"}], "]"}]}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.594554524175709*^9, 3.594554551542274*^9}, {
  3.5945547288684163`*^9, 3.594554734991767*^9}, {3.5945548232268133`*^9, 
  3.59455483802566*^9}, {3.594555975301708*^9, 3.594555979814966*^9}, {
  3.5950655887114344`*^9, 3.5950655895174804`*^9}, {3.59507278450501*^9, 
  3.5950727851580477`*^9}, {3.640586322340191*^9, 3.640586352292054*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Energy", "[", "w_", "]"}], ":=", 
  RowBox[{"CATCrossEntropy", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"TrainingLabels", "[", 
      RowBox[{"[", 
       RowBox[{"1", ";;", "100"}], "]"}], "]"}], "+", "1"}], ",", " ", 
    RowBox[{"RTrainingImages", "[", 
     RowBox[{"[", 
      RowBox[{"1", ";;", "100"}], "]"}], "]"}], ",", " ", 
    RowBox[{"myF", "[", "w", "]"}]}], " ", "]"}]}]], "Input",
 CellChangeTimes->{{3.594815124446046*^9, 3.594815151477592*^9}, {
  3.594816494965435*^9, 3.594816509956293*^9}, {3.595062784068018*^9, 
  3.5950628011639957`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dynamic", "[", 
  RowBox[{"{", 
   RowBox[{"iter", ",", 
    RowBox[{"energy", "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{"-", "5"}], ";;", 
       RowBox[{"-", "1"}]}], "]"}], "]"}]}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.5948151596460595`*^9, 3.594815171357729*^9}, {
  3.595320661550787*^9, 3.595320676026615*^9}}],

Cell[BoxData[
 DynamicBox[ToBoxes[{$CellContext`iter, 
    Part[$CellContext`energy, 
     Span[-5, -1]]}, StandardForm],
  ImageSizeCache->{252., {3., 11.}}]], "Output",
 CellChangeTimes->{3.5948151718337564`*^9, 3.5948165124404345`*^9, 
  3.5949637694366937`*^9, 3.595060483589438*^9, 3.595062647996235*^9, 
  3.5950628075693617`*^9, 3.595065046739435*^9, 3.595082839007674*^9, 
  3.595313383373082*^9, 3.595313590849366*^9, 3.595320676432638*^9, 
  3.5956625584788094`*^9, 3.640585275143733*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"timers", "=", "False"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"CATTraining", "[", "True", "]"}]}], "Input",
 CellChangeTimes->{{3.595146723110022*^9, 3.5951467471193953`*^9}, {
  3.5953203498649597`*^9, 3.5953203541692057`*^9}, {3.64058789262016*^9, 
  3.640587892978961*^9}, {3.640589225040767*^9, 3.64058922596457*^9}}],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{3.640586194230748*^9, 3.64058636148847*^9, 
  3.6405865715784883`*^9, 3.640586911209168*^9, 3.6405879018333797`*^9, 
  3.640589218483755*^9, 3.6405894642002106`*^9}]
}, Open  ]]
},
WindowSize->{1097, 637},
WindowMargins->{{20, Automatic}, {41, Automatic}},
FrontEndVersion->"8.0 for Microsoft Windows (64-bit) (February 23, 2011)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 113, 3, 67, "Code"],
Cell[673, 25, 1759, 47, 260, "Input"],
Cell[2435, 74, 37029, 816, 3276, "Input"],
Cell[39467, 892, 1535, 37, 125, "Input"],
Cell[41005, 931, 215, 4, 43, "Input"],
Cell[41223, 937, 1410, 34, 206, "Input"],
Cell[CellGroupData[{
Cell[42658, 975, 189, 3, 43, "Input"],
Cell[42850, 980, 97, 1, 42, "Output"]
}, Open  ]],
Cell[42962, 984, 493, 13, 43, "Input"],
Cell[43458, 999, 99, 2, 43, "Input"],
Cell[43560, 1003, 2253, 53, 179, "Input"],
Cell[45816, 1058, 653, 13, 43, "Input"],
Cell[46472, 1073, 600, 15, 71, "Input"],
Cell[CellGroupData[{
Cell[47097, 1092, 362, 10, 43, "Input"],
Cell[47462, 1104, 498, 9, 42, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[47997, 1118, 360, 6, 71, "Input"],
Cell[48360, 1126, 220, 3, 42, "Output"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
